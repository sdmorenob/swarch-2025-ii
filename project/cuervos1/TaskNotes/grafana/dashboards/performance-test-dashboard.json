{
  "id": null,
  "title": "TaskNotes - Performance Test (Prometheus)",
  "tags": ["tasknotes", "k6", "performance"],
  "editable": true,
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 1,
  "refresh": "10s",
  "time": { "from": "now-15m", "to": "now" },
  "templating": {
    "list": [
      {
        "type": "query",
        "name": "testid",
        "label": "Test ID",
        "datasource": { "type": "prometheus", "uid": "Prometheus" },
        "query": "label_values(k6_http_reqs, testid)",
        "refresh": 1,
        "includeAll": true,
        "multi": false,
        "hide": 0
      }
    ]
  },
  "panels": [
    {
      "type": "stat",
      "title": "RPS (http_reqs)",
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "gridPos": { "h": 6, "w": 8, "x": 0, "y": 0 },
      "targets": [
        { "expr": "sum(rate(k6_http_reqs[1m]))", "legendFormat": "RPS", "refId": "A" }
      ],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"], "values": false } }
    },
    {
      "type": "stat",
      "title": "Error rate %",
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "gridPos": { "h": 6, "w": 8, "x": 8, "y": 0 },
      "targets": [
        { "expr": "100 * (sum(rate(k6_http_req_failed[1m])) / clamp_min(sum(rate(k6_http_reqs[1m])), 1))", "legendFormat": "Errors %", "refId": "A" }
      ],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"], "values": false } }
    },
    {
      "type": "stat",
      "title": "VUs",
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "gridPos": { "h": 6, "w": 8, "x": 16, "y": 0 },
      "targets": [
        { "expr": "sum(k6_vus)", "legendFormat": "VUs", "refId": "A" }
      ],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"], "values": false } }
    },
    {
      "type": "timeseries",
      "title": "Latency (avg)",
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "gridPos": { "h": 8, "w": 16, "x": 0, "y": 6 },
      "targets": [
        { "expr": "avg(k6_http_req_duration)", "legendFormat": "avg", "refId": "A" }
      ],
      "options": { "legend": { "showLegend": true } }
    },
    {
      "type": "timeseries",
      "title": "Latency (p95 approx)",
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "gridPos": { "h": 8, "w": 16, "x": 0, "y": 14 },
      "targets": [
        { "expr": "quantile_over_time(0.95, k6_http_req_duration[$__interval])", "legendFormat": "p95", "refId": "A" }
      ],
      "options": { "legend": { "showLegend": true } }
    },
    {
      "type": "timeseries",
      "title": "Latency por testid (avg)",
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 22 },
      "targets": [
        { "expr": "avg by (testid) (k6_http_req_duration{testid=~\"$testid\"})", "legendFormat": "{{testid}}", "refId": "A" }
      ],
      "options": { "legend": { "showLegend": true } }
    }
  ],
  "uid": "tasknotes-performance-prom",
  "title": "TaskNotes - Performance Test (Prometheus)"
}