apiVersion: batch/v1
kind: Job
metadata:
  name: k6-prometheus
  namespace: default
spec:
  template:
    spec:
      containers:
        - name: k6
          image: grafana/k6:latest
          env:
            - name: K6_INSECURE_SKIP_TLS_VERIFY
              value: "true"
            - name: K6_PROMETHEUS_RW_SERVER_URL
              value: "http://prometheus.default.svc.cluster.local:9090/api/v1/write"
            # Producci√≥n. Comentar si se ejecuta en local
            - name: TARGET_URL
              value: "https://136.112.28.155/api/users/health"

          command: ["k6"]
          args:
            [
              "run",
              "--out=experimental-prometheus-rw",
              "/scripts/k6_rate_limit_test.js"
            ]
          volumeMounts:
            - name: k6-scripts
              mountPath: /scripts
      restartPolicy: Never
      volumes:
        - name: k6-scripts
          configMap:
            name: k6-scripts