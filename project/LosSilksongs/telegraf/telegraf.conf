# Telegraf configuration for ingesting Traefik access logs (JSON) into InfluxDB v1

[agent]
  interval = "10s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = "ms"
  logfile = ""

# ==========================
# Inputs
# ==========================

# Tail Traefik access logs (JSON format)
[[inputs.tail]]
  files = ["/var/log/traefik/access.log"]
  from_beginning = false
  name_override = "traefik_access_log"
  data_format = "json"
  ## When parsing JSON, Telegraf will store all fields; you can tag some keys if present
  tag_keys = ["RouterName", "ServiceName", "EntryPoint", "ClientAddr"]
  json_time_key = "StartUTC"
  json_time_format = "2006-01-02T15:04:05Z07:00"

# ==========================
# Outputs
# ==========================

[[outputs.influxdb]]
  urls = ["http://influxdb:8086"]
  database = "traefik"
  retention_policy = "one_week"
  write_consistency = "any"
  timeout = "5s"
