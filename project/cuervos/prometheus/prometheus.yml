global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    environment: 'development'
    cluster: 'tasknotes'

rule_files:
  - "alert-rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

scrape_configs:
  - job_name: 'nginx'
    static_configs:
      - targets: ['nginx-exporter:9113']
        labels:
          service: 'nginx'
          version: 'v1.0'

  - job_name: 'api-gateway'
    metrics_path: /metrics
    scheme: http
    static_configs:
      - targets: ['api-gateway:8083']
        labels:
          service: 'api-gateway'
          version: 'v1.0'
          technology: 'python'

  - job_name: 'python-services'
    metrics_path: /metrics
    scheme: http
    static_configs:
      - targets: ['auth-service:8002']
        labels:
          service: 'auth-service'
          version: 'v1.0'
          technology: 'python'
          instance_id: '1'
      - targets: ['auth-service-2:8002']
        labels:
          service: 'auth-service'
          version: 'v1.0'
          technology: 'python'
          instance_id: '2'
      - targets: ['tasks-service:8003']
        labels:
          service: 'tasks-service'
          version: 'v1.0'
          technology: 'python'
          instance_id: '1'
      - targets: ['tasks-service-2:8003']
        labels:
          service: 'tasks-service'
          version: 'v1.0'
          technology: 'python'
          instance_id: '2'
      - targets: ['notes-service:8004']
        labels:
          service: 'notes-service'
          version: 'v1.0'
          technology: 'python'
          instance_id: '1'
      - targets: ['notes-service-2:8004']
        labels:
          service: 'notes-service'
          version: 'v1.0'
          technology: 'python'
          instance_id: '2'
      - targets: ['tags-service:8005']
        labels:
          service: 'tags-service'
          version: 'v1.0'
          technology: 'python'
          instance_id: '1'
      - targets: ['tags-service-2:8005']
        labels:
          service: 'tags-service'
          version: 'v1.0'
          technology: 'python'
          instance_id: '2'

  - job_name: 'dotnet-services'
    metrics_path: /metrics
    scheme: http
    static_configs:
      - targets: ['categories-service:8006']
        labels:
          service: 'categories-service'
          version: 'v1.0'
          technology: 'dotnet'
          instance_id: '1'
      - targets: ['categories-service-2:8006']
        labels:
          service: 'categories-service'
          version: 'v1.0'
          technology: 'dotnet'
          instance_id: '2'
      - targets: ['user-profile-service:8007']
        labels:
          service: 'user-profile-service'
          version: 'v1.0'
          technology: 'dotnet'
          instance_id: '1'
      - targets: ['user-profile-service-2:8007']
        labels:
          service: 'user-profile-service'
          version: 'v1.0'
          technology: 'dotnet'
          instance_id: '2'

  - job_name: 'go-services'
    metrics_path: /metrics
    scheme: http
    static_configs:
      - targets: ['search-service:8008']
        labels:
          service: 'search-service'
          version: 'v1.0'
          technology: 'go'
          instance_id: '1'
      - targets: ['search-service-2:8008']
        labels:
          service: 'search-service'
          version: 'v1.0'
          technology: 'go'
          instance_id: '2'

  - job_name: 'java-logs'
    metrics_path: /actuator/prometheus
    scheme: http
    static_configs:
      - targets: ['logs-service:8010']
        labels:
          service: 'logs-service'
          version: 'v1.0'
          technology: 'java'
          instance_id: '1'

  # Database Exporters
  - job_name: 'postgres'
    metrics_path: /metrics
    scheme: http
    static_configs:
      - targets: ['postgres-exporter-auth:9187']
        labels:
          service: 'postgres'
          database: 'auth'
          version: 'v15'
          technology: 'postgres'
      - targets: ['postgres-exporter-tasks:9187']
        labels:
          service: 'postgres'
          database: 'tasks'
          version: 'v15'
          technology: 'postgres'
      - targets: ['postgres-exporter-tags:9187']
        labels:
          service: 'postgres'
          database: 'tags'
          version: 'v15'
          technology: 'postgres'
      - targets: ['postgres-exporter-categories:9187']
        labels:
          service: 'postgres'
          database: 'categories'
          version: 'v15'
          technology: 'postgres'
      - targets: ['postgres-exporter-user-profile:9187']
        labels:
          service: 'postgres'
          database: 'user-profile'
          version: 'v15'
          technology: 'postgres'

  - job_name: 'rabbitmq'
    metrics_path: /metrics
    scheme: http
    static_configs:
      - targets: ['rabbitmq-exporter:9419']
        labels:
          service: 'rabbitmq'
          version: 'v3'
          technology: 'rabbitmq'

  - job_name: 'mongodb'
    metrics_path: /metrics
    scheme: http
    static_configs:
      - targets: ['mongodb-exporter-notes:9216']
        labels:
          service: 'mongodb'
          database: 'notes'
          version: 'v6'
          technology: 'mongodb'
      - targets: ['mongodb-exporter-logs:9216']
        labels:
          service: 'mongodb'
          database: 'logs'
          version: 'v6'
          technology: 'mongodb'